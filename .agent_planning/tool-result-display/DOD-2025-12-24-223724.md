# Definition of Done: Tool Result Display

**Generated**: 2025-12-24-223724
**Plan**: PLAN-2025-12-24-223724.md
**Epic**: brandon-fryslie_claude-code-proxy-k6y

---

## Acceptance Criteria

### Base ToolResult Component
- [ ] Component renders success results with green gradient theme (emerald/green)
- [ ] Component renders error results with red gradient theme (red/pink)
- [ ] Component displays tool result ID in header if provided
- [ ] Component shows content type badge (Code, JSON, Text)
- [ ] Component shows character count for non-code content
- [ ] Component displays success/error indicator with status dot
- [ ] Component has expand/collapse for large content (>500 chars)
- [ ] Component uses lucide-react icons: CheckCircle, AlertCircle, Database, FileText, Clock
- [ ] Unit tests cover success and error states

### Content Type Detection
- [ ] Detects code by checking for cat -n line numbers (pattern: `^\s*\d+→`)
- [ ] Detects code by checking for code patterns (function, const, import, class, etc.)
- [ ] Detects code by checking for file extensions in content
- [ ] Detects JSON by checking for isComplexObject or string starting with '{'
- [ ] Falls back to text for other content types
- [ ] isCodeContent() returns boolean based on heuristics
- [ ] Content type badge displays correct type (Code, JSON, Text)
- [ ] Unit tests verify all detection patterns

### cat -n Format Parser
- [ ] Detects cat -n format by checking for line number pattern (`^\s*\d+→`)
- [ ] Extracts code by removing line numbers from each line
- [ ] Preserves original line content after arrow (→) character
- [ ] Returns unchanged content if not cat -n format
- [ ] extractCodeFromCatN() returns { code: string, fileName?: string }
- [ ] Handles edge cases (empty lines, malformed line numbers)
- [ ] Unit tests verify parsing with sample cat -n output

### Content Structure Handling
- [ ] Returns content directly if type is string
- [ ] Returns content.text if object has 'text' property
- [ ] Returns content.content if object has 'content' property
- [ ] Joins array items with newlines using formatValue()
- [ ] Returns formatJSON() for complex objects
- [ ] Falls back to formatValue() for primitives
- [ ] getDisplayContent() handles all content structures
- [ ] Unit tests verify all structure types

### CodeViewer Integration
- [ ] Renders CodeViewer when isCode === true
- [ ] Passes extracted code to CodeViewer (cleaned from cat -n format)
- [ ] Passes fileName if available (currently undefined in MVP)
- [ ] Falls back to pre block if CodeViewer unavailable
- [ ] Does not show character count for code content
- [ ] Unit tests verify CodeViewer integration
- [ ] Integration tests verify code rendering in full request view

### JSON and Text Rendering
- [ ] JSON content renders in gray pre block with monospace font
- [ ] JSON uses formatted JSON string (truncated if shouldTruncate)
- [ ] Text content renders with line breaks preserved (replace \n with <br>)
- [ ] Text content uses dangerouslySetInnerHTML for HTML rendering
- [ ] Text content breaks long words (break-words class)
- [ ] Text content has relaxed leading for readability
- [ ] Unit tests verify JSON and text rendering
- [ ] Unit tests verify truncation behavior

### Large Content Handling
- [ ] Detects large content (displayContent.length > 500)
- [ ] Truncates content to 500 chars when not expanded
- [ ] Shows truncated content in collapsed state
- [ ] Shows full content in expanded state
- [ ] Displays "Show full content (N characters)" button when truncated
- [ ] Button updates state to expand content
- [ ] Does not truncate code content (handled by CodeViewer)
- [ ] Unit tests verify truncation and expansion

### Raw Data Structure View
- [ ] Shows raw data details if content is object with >1 property
- [ ] Uses collapsible <details> element
- [ ] Summary text: "Show raw data structure"
- [ ] Displays formatted JSON in monospace pre block
- [ ] Uses formatJSON() utility for formatting
- [ ] Chevron icon rotates on expand (group-open:rotate-90)
- [ ] Unit tests verify details rendering and toggle

### MessageContent Integration
- [ ] MessageContent imports ToolResult component
- [ ] MessageContent renders ToolResult for content.type === 'tool_result'
- [ ] Passes content (text or content property) to ToolResult
- [ ] Passes tool_call_id or id as toolId prop
- [ ] Passes is_error flag to isError prop
- [ ] Handles missing properties gracefully (defaults to false for isError)
- [ ] Integration tests verify tool_result rendering in full request view
- [ ] Tool results appear correctly in Requests page detail panel

---

## Sprint Scope

### This Sprint Delivers
1. **ToolResult Component** - Full-featured tool result visualization
2. **Content Type Detection** - Intelligent code/JSON/text detection
3. **cat -n Parser** - Read tool output parsing
4. **MessageContent Integration** - Tool results visible in Requests page

### Deferred
- CodeViewer component (separate epic: code-viewer-highlighting)
- Syntax highlighting implementation (handled by CodeViewer)
- Tool result export functionality
- Advanced code parsing beyond cat -n format
