# Definition of Done: Date Navigation & Filtering

**Generated**: 2025-12-24-223454
**Plan**: PLAN-2025-12-24-223454.md
**Epic**: brandon-fryslie_claude-code-proxy-kbm

---

## Sprint Scope

This sprint delivers: **Date picker component, week navigation, and smart refetching**
Deferred: Month/year navigation, custom date range picker, timezone customization

---

## Acceptance Criteria

### Week Boundary Calculation Logic

- [ ] `getWeekBoundaries(date: Date)` function returns `{ weekStart: Date, weekEnd: Date }` where weekStart is Sunday 00:00:00 and weekEnd is Saturday 23:59:59.999
- [ ] Function handles edge cases: month boundaries, year boundaries, leap years
- [ ] Unit tests verify correct week calculation for dates in different months/years
- [ ] Function exported from `lib/utils.ts` for reuse across components

### Date Picker Component

- [ ] Date input component renders with current selected date
- [ ] Clicking date input opens native date picker (use `<input type="date">` for simplicity)
- [ ] Selecting a new date triggers data refetch with correct date boundaries
- [ ] Component displays selected date in readable format (e.g., "Dec 24, 2024")
- [ ] E2E test: User selects date â†’ requests list updates to show that day's data

### Week Navigation Controls

- [ ] "Previous Week" button decrements selected date by 7 days and refetches data
- [ ] "Next Week" button increments selected date by 7 days and refetches data
- [ ] Next button disabled if selected week contains today (cannot go into future)
- [ ] Keyboard shortcuts: Arrow left/right navigate weeks (stretch goal)
- [ ] Week range displayed: "Dec 22 - Dec 28" next to navigation buttons

### Smart Refetching Logic

- [ ] State variable tracks `currentWeekStart` (Sunday of current loaded week)
- [ ] Navigating to different day in same week: only fetch hourly + model stats (2 API calls)
- [ ] Navigating to different week: fetch weekly + hourly + model stats (3 API calls)
- [ ] TanStack Query cache configured to prevent redundant fetches within same session
- [ ] Performance test: Navigating same week completes <500ms, new week <1s

### Persist Selected Date

- [ ] Selected date persisted to localStorage on change
- [ ] On page load, read persisted date and use as initial selected date (if valid)
- [ ] If persisted date is >7 days old, default to "today" instead
- [ ] URL param `?date=YYYY-MM-DD` overrides localStorage (for sharing links)
- [ ] Clearing localStorage or invalid date falls back to today

---

## Integration Verification

- [ ] Date picker integrated into Dashboard page header
- [ ] Date picker integrated into Requests page header
- [ ] Week navigation controls work on both pages
- [ ] Smart refetching reduces API calls by ~33% when navigating within same week
- [ ] All date utilities have unit tests with >90% coverage

---

## Quality Gates

- [ ] All unit tests pass
- [ ] No TypeScript errors
- [ ] No console errors during date navigation
- [ ] Manual testing confirms date boundaries are correct across month/year transitions
- [ ] Code review completed and approved
