# Sprint Plan: Tool Use Display

**Generated**: 2025-12-24-223724
**Source**: STATUS-20251224.md (dashboard-parity evaluation)
**Epic**: brandon-fryslie_claude-code-proxy-62s
**Sprint Goal**: Implement rich tool call visualization with expandable UI showing tool names, parameters, and special handling for common tools like Edit, Read, and TodoWrite.

---

## Executive Summary

**Current State** (from STATUS-20251224.md):
- New dashboard displays tool calls as raw JSON in request details
- Missing dedicated ToolUse component that old dashboard has (208 LOC)
- No special handling for Edit diffs, Read file paths, or TodoWrite lists
- No copy-to-clipboard functionality for tool calls

**Target State** (from web/app/components/ToolUse.tsx):
- Expandable tool call cards with gradient styling
- Parse and display tool name, ID, and input parameters
- Special rendering for Edit tool (shows code diff)
- Special rendering for Read tool (shows file path)
- Special rendering for TodoWrite tool (shows task list)
- Copy-to-clipboard for tool call details
- Parameter value formatting (strings, objects, large text)

**Gap**: New dashboard needs a complete ToolUse component to match old dashboard's rich visualization.

---

## Scope

### In Scope
- Create ToolUse component in `dashboard/src/components/`
- Parse tool call JSON from `AnthropicContentBlock` type (type: "tool_use")
- Display tool name, ID, and parameters in expandable card UI
- Implement special handling for Edit tool (integrate with CodeDiff component)
- Implement special handling for Read tool (display file path)
- Implement special handling for TodoWrite tool (display todo list)
- Add copy-to-clipboard functionality for tool call details
- Handle large parameter values (truncate, expand on click)
- Handle complex object parameters (collapsible JSON view)
- Integrate with MessageContent component in Requests page

### Out of Scope
- CodeDiff component (separate epic: code-viewer-highlighting)
- TodoList component (will be created as part of this sprint)
- Tool execution state tracking (e.g., pending, completed)
- Tool execution time metrics
- Backend changes to tool call logging

### Deferred
- Tool call filtering/search in request list
- Tool usage analytics dashboard
- Tool call replay/re-execution

---

## Work Items

### [P0] Create Base ToolUse Component

**Status**: Not Started
**Effort**: Medium (3-5 days)
**Dependencies**: None
**Spec Reference**: web/app/components/ToolUse.tsx • **Status Reference**: STATUS-20251224.md §2.2 (Advanced Features)

#### Description
Create the core ToolUse component that renders tool calls with expandable parameters, gradient styling, and metadata display. This is the foundation for all tool visualization.

#### Acceptance Criteria
- [ ] Component renders tool name with icon in gradient card (indigo/blue theme)
- [ ] Component displays tool call ID in header
- [ ] Component shows parameter count badge
- [ ] Component has expand/collapse toggle for parameters (auto-collapse if >2 params)
- [ ] Component displays "Tool execution initiated" indicator with pulsing dot
- [ ] Component handles missing input gracefully (empty object)
- [ ] Unit tests cover all UI states (collapsed, expanded, no params, many params)

#### Technical Notes
- Use lucide-react icons: Wrench, ChevronDown, ChevronRight, Terminal, Zap
- Gradient: `bg-gradient-to-r from-indigo-50 to-blue-50`
- Icon badge: `bg-gradient-to-br from-indigo-500 to-blue-600`
- Follows existing component pattern in dashboard (Tailwind classes)

---

### [P0] Implement Parameter Rendering

**Status**: Not Started
**Effort**: Medium (3-5 days)
**Dependencies**: Create Base ToolUse Component
**Spec Reference**: ToolUse.tsx lines 28-64 • **Status Reference**: STATUS-20251224.md §2.2

#### Description
Implement intelligent parameter value rendering that handles strings, objects, and large text with appropriate formatting and truncation.

#### Acceptance Criteria
- [ ] Short strings (<200 chars, no newlines) render inline with monospace font
- [ ] Large strings (>200 chars or multiline) show "Show/Hide large parameter" toggle
- [ ] Complex objects show "Show object (N properties)" collapsible details
- [ ] Expanded large parameters display in scrollable pre block (max-height: 256px)
- [ ] Parameter values use formatValue() and formatJSON() utilities
- [ ] Each parameter displays in gray card with key highlighted in indigo
- [ ] Unit tests verify truncation, expansion, and object handling

#### Technical Notes
- Import formatters from `../utils/formatters` (create if missing)
- Use `isComplexObject()` helper to detect objects vs primitives
- Large text preview pattern: show toggle button, render in `<pre>` on expand
- Parameter grid uses `space-y-3` with individual cards for each param

---

### [P1] Add Copy-to-Clipboard Functionality

**Status**: Not Started
**Effort**: Small (1-2 days)
**Dependencies**: Create Base ToolUse Component
**Spec Reference**: ToolUse.tsx lines 18-26, 91-101 • **Status Reference**: STATUS-20251224.md §2.2

#### Description
Add copy-to-clipboard button in tool card header that copies tool name, ID, and input as JSON. Shows checkmark confirmation on successful copy.

#### Acceptance Criteria
- [ ] Copy button appears in tool card header (Copy icon from lucide-react)
- [ ] Button copies `{ name, id, input }` as formatted JSON to clipboard
- [ ] Button shows checkmark icon for 2 seconds after successful copy
- [ ] Button handles copy errors gracefully (logs to console, no crash)
- [ ] Button has hover state with indigo accent
- [ ] Unit tests verify copy behavior (mock clipboard API)

#### Technical Notes
- Use `navigator.clipboard.writeText()` API
- Format JSON with `formatJSON()` utility
- Icon transition: Copy → Check (2 second timeout) → Copy
- Button classes: `hover:text-indigo-600 hover:bg-white transition-all duration-200`

---

### [P1] Implement Edit Tool Special Handling

**Status**: Not Started
**Effort**: Small (1-2 days)
**Dependencies**: Create Base ToolUse Component, CodeDiff component available
**Spec Reference**: ToolUse.tsx lines 105-115 • **Status Reference**: STATUS-20251224.md §2.2

#### Description
Add special rendering for Edit tool calls that displays code diff instead of raw parameters. Shows old_string vs new_string with syntax highlighting.

#### Acceptance Criteria
- [ ] Detects Edit tool by checking `name === 'Edit'`
- [ ] Renders CodeDiff component with old_string, new_string, file_path
- [ ] Shows "Code Changes" section header above diff
- [ ] Hides raw parameters when showing custom Edit view
- [ ] Falls back to raw parameters if old_string or new_string missing
- [ ] Unit tests verify Edit detection and CodeDiff integration

#### Technical Notes
- CodeDiff component expected at `../components/CodeDiff` (from code-viewer epic)
- Extract `input.old_string`, `input.new_string`, `input.file_path`
- Conditional rendering: `{name === 'Edit' && input.old_string && input.new_string && ...}`
- Skip raw parameter display for Edit and TodoWrite tools

---

### [P1] Implement Read Tool Special Handling

**Status**: Not Started
**Effort**: Small (1-2 days)
**Dependencies**: Create Base ToolUse Component
**Spec Reference**: ToolUse.tsx lines 117-126 • **Status Reference**: STATUS-20251224.md §2.2

#### Description
Add special rendering for Read tool calls that prominently displays the file path being read. Provides context before seeing file contents in ToolResult.

#### Acceptance Criteria
- [ ] Detects Read tool by checking `name === 'Read'`
- [ ] Shows "File Contents" section header
- [ ] Displays file_path in monospace with "Reading: " prefix
- [ ] Uses small text (text-xs) with gray color scheme
- [ ] Still shows other parameters if present (limit, offset)
- [ ] Unit tests verify Read detection and file path display

#### Technical Notes
- Extract `input.file_path` from parameters
- Display pattern: `Reading: <span className="font-mono">{input.file_path}</span>`
- Note in UI: "The actual file content will be in the tool result, not the input"
- Keep simple - this is just a preview, ToolResult shows actual content

---

### [P1] Implement TodoWrite Tool Special Handling

**Status**: Not Started
**Effort**: Medium (3-5 days)
**Dependencies**: Create Base ToolUse Component, Create TodoList Component
**Spec Reference**: ToolUse.tsx lines 128-134 • **Status Reference**: STATUS-20251224.md §2.2

#### Description
Add special rendering for TodoWrite tool calls that displays tasks in a formatted list instead of raw JSON. Shows task status, content, and active form.

#### Acceptance Criteria
- [ ] Detects TodoWrite tool by checking `name === 'TodoWrite'`
- [ ] Shows "Task Management" section header
- [ ] Renders TodoList component with `input.todos` array
- [ ] Validates todos is an array before rendering
- [ ] Falls back to raw parameters if todos missing/invalid
- [ ] Hides raw parameters when showing TodoList
- [ ] Unit tests verify TodoWrite detection and TodoList integration

#### Technical Notes
- TodoList component needs to be created (see next work item)
- Extract `input.todos` array from parameters
- Conditional: `{name === 'TodoWrite' && input.todos && Array.isArray(input.todos) && ...}`
- TodoList component expected at `../components/TodoList`

---

### [P1] Create TodoList Component

**Status**: Not Started
**Effort**: Medium (3-5 days)
**Dependencies**: None
**Spec Reference**: web/app/components/TodoList.tsx (189 LOC) • **Status Reference**: STATUS-20251224.md §2.2

#### Description
Create standalone TodoList component that renders task lists with status badges, content, and active form. Used by ToolUse for TodoWrite tools.

#### Acceptance Criteria
- [ ] Component accepts `todos` prop (array of todo objects)
- [ ] Each todo displays status badge (pending, in_progress, completed)
- [ ] Each todo shows content (imperative form)
- [ ] In-progress todos show activeForm if present
- [ ] Completed todos show checkmark icon
- [ ] Status badges use appropriate colors (gray, blue, green)
- [ ] Component handles empty array gracefully
- [ ] Unit tests verify all status types and edge cases

#### Technical Notes
- Todo type: `{ content: string, status: 'pending' | 'in_progress' | 'completed', activeForm?: string }`
- Status colors: pending (gray), in_progress (blue), completed (green)
- Use lucide-react icons: CheckCircle, Clock, Circle
- Layout: vertical list with spacing, cards for each todo

---

### [P0] Integrate ToolUse with MessageContent

**Status**: Not Started
**Effort**: Small (1-2 days)
**Dependencies**: Create Base ToolUse Component
**Spec Reference**: web/app/components/MessageContent.tsx lines 71-79 • **Status Reference**: STATUS-20251224.md §2.2

#### Description
Update MessageContent component to use new ToolUse component when rendering content blocks of type "tool_use". Ensures tool calls appear in request detail view.

#### Acceptance Criteria
- [ ] MessageContent imports ToolUse component
- [ ] MessageContent renders ToolUse for content.type === 'tool_use'
- [ ] Passes name, id, input props from content block
- [ ] Handles missing name/id gracefully (defaults: 'Unknown Tool', 'unknown')
- [ ] Handles missing input gracefully (empty object)
- [ ] Integration tests verify tool_use rendering in full request view
- [ ] Tool calls appear correctly in Requests page detail panel

#### Technical Notes
- MessageContent location: `dashboard/src/components/MessageContent.tsx` (create if missing)
- Content block type from AnthropicContentBlock: `{ type: 'tool_use', name: string, id: string, input: any }`
- Pattern from old dashboard: `case 'tool_use': return <ToolUse name={...} id={...} input={...} />`
- Ensure MessageContent handles both single content objects and arrays

---

## Dependencies

### Component Dependencies
```
ToolUse Component
├── formatters (formatValue, formatJSON, isComplexObject)
├── CodeDiff (for Edit tool) - from code-viewer epic
├── TodoList (for TodoWrite tool) - created in this sprint
└── lucide-react icons (Wrench, Copy, Check, etc.)

MessageContent Component
└── ToolUse Component
```

### Data Flow
```
AnthropicRequest (backend)
└── messages[].content[] (AnthropicContentBlock)
    └── { type: 'tool_use', name, id, input }
        └── <ToolUse> component
            ├── Edit → <CodeDiff>
            ├── TodoWrite → <TodoList>
            └── Read → file path display
```

---

## Recommended Sprint Planning

### Sprint Breakdown (1 sprint = 1 week)

**Week 1: Core ToolUse Component**
1. Create Base ToolUse Component (P0)
2. Implement Parameter Rendering (P0)
3. Add Copy-to-Clipboard Functionality (P1)
4. Integrate ToolUse with MessageContent (P0)

**Week 2: Special Tool Handling**
5. Create TodoList Component (P1)
6. Implement TodoWrite Tool Special Handling (P1)
7. Implement Read Tool Special Handling (P1)
8. Implement Edit Tool Special Handling (P1) - requires CodeDiff from other sprint

**Parallel Work**: CodeDiff component from code-viewer-highlighting epic can be developed in parallel.

---

## Risk Assessment

### High Risk
- **CodeDiff Dependency**: Edit tool special handling blocked until CodeDiff component exists
  - **Mitigation**: Develop CodeDiff in parallel sprint, or stub Edit rendering initially

### Medium Risk
- **Formatter Utilities Missing**: New dashboard may not have formatValue, formatJSON helpers
  - **Mitigation**: Port from old dashboard utils/formatters.ts or recreate minimal versions

- **MessageContent Component Structure**: New dashboard may use different message rendering pattern
  - **Mitigation**: Review existing Requests page to understand current pattern, adapt integration approach

### Low Risk
- **Clipboard API Support**: Some browsers may not support navigator.clipboard
  - **Mitigation**: Add fallback to document.execCommand or show "unsupported" message

---

## Testing Strategy

### Unit Tests
- ToolUse component rendering (all states, all parameter types)
- TodoList component rendering (all status types)
- Copy-to-clipboard functionality (mock clipboard API)
- Parameter rendering edge cases (empty, null, undefined, malformed)

### Integration Tests
- MessageContent → ToolUse integration
- ToolUse → TodoList integration (TodoWrite tools)
- ToolUse → CodeDiff integration (Edit tools)

### Manual Testing
- Verify tool calls render correctly in Requests page
- Test expand/collapse interactions
- Test copy-to-clipboard in different browsers
- Verify special tool handling (Edit, Read, TodoWrite) with real request data

---

## Definition of Done

See DOD-2025-12-24-223724.md for detailed acceptance criteria.

**Sprint Complete When**:
- ✅ All P0 work items completed and tested
- ✅ All P1 work items completed and tested
- ✅ Tool calls visible in new dashboard Requests page
- ✅ Special handling working for Edit, Read, TodoWrite tools
- ✅ Copy-to-clipboard functional
- ✅ Unit tests passing (>80% coverage)
- ✅ Integration tests passing
- ✅ Manual testing verified on real request data

---

## Blockers and Questions

### Blockers
None currently - all dependencies can be created within this sprint or stubbed.

### Questions
1. **Formatter Utilities**: Does new dashboard have formatValue/formatJSON utilities? If not, should we port from old dashboard or create minimal versions?
2. **CodeDiff Timeline**: When will CodeDiff component be ready? Should we stub Edit tool handling initially?
3. **Component Location**: Should ToolUse go in `components/` or `components/requests/` subdirectory?
4. **Styling Consistency**: Should we match old dashboard's indigo gradient styling exactly, or adapt to new dashboard's theme?

---

## Success Metrics

- **Feature Parity**: Tool calls match old dashboard visualization quality
- **User Experience**: Developers can quickly identify tool names and parameters
- **Special Tools**: Edit diffs, Read file paths, TodoWrite tasks are immediately visible
- **Performance**: No lag when expanding/collapsing large parameter sets
- **Code Quality**: Components are reusable, well-tested, maintainable
