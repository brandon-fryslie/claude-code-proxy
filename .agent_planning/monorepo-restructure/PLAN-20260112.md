# Sprint Plan: Monorepo Restructure - Proxy-Core Extraction

**Sprint Duration**: 1 week (5 working days)
**Status**: Ready to Implement
**Estimated Effort**: 40 hours

## Sprint Goal

Extract `proxy-core` from the monolithic `proxy/` module into a standalone Go module. This is the lowest-risk foundation for future monorepo restructuring.

## Why Proxy-Core First?

- **Stable service**: Rarely changes, minimal dependencies
- **No internal deps**: Doesn't depend on proxy-data
- **Clear boundaries**: All handler code stays intact
- **Foundation**: Establishes go.mod replacement pattern for proxy-data Phase 2

## Scope (This Sprint)

**In Scope:**
- P0: Extract proxy-core into standalone module with independent go.mod
- Update build system (Justfile, Docker) to handle separate modules
- Verify all tests pass and Docker builds work
- Update documentation

**Out of Scope (Future Sprints):**
- proxy-data extraction (Phase 2)
- cc-viz frontend consolidation (Phase 3)
- Workspace configuration (Phase 4)

## Work Items

### P0: Extract proxy-core Module (5 days)

**Day 1**: Setup directory structure and go.mod creation
- Create `proxy-core/` with correct internal package layout
- Create `proxy-core/go.mod` with minimal dependencies
- Update `proxy/go.mod` with go.mod replacement directive

**Day 2**: Update build system
- Update Justfile with separate build targets
- Add module-specific test commands
- Verify `go mod tidy` passes in both modules

**Day 3**: Docker build updates
- Update `docker/Dockerfile.proxy-core` to handle both modules
- Test Docker image builds successfully
- Test container starts and health check responds

**Day 4**: Comprehensive testing
- Unit tests pass in both modules
- Integration tests verify shared code works
- Zero-downtime deployment scenario
- Local and Docker testing

**Day 5**: Documentation and commits
- Update CLAUDE.md with new module structure
- Update README.md with architecture diagram
- Create clean, atomic git commits
- Final verification: `just clean && just build && just test`

## Success Criteria

- [x] proxy-core directory exists with proper structure
- [x] proxy-core/go.mod created and validates
- [x] proxy/go.mod replacement directive works
- [x] `just build` succeeds for both modules
- [x] `just test` passes in both modules
- [x] Docker image builds and runs
- [x] Health endpoints respond correctly
- [x] Zero-downtime deployment works
- [x] Documentation updated
- [x] Git history is clean and atomic

## Dependencies

- No external dependencies on other phases
- Must complete before proxy-data extraction (Phase 2)
- Creates reusable pattern for cc-viz frontend move (Phase 3)

## Risks & Mitigations

| Risk | Likelihood | Impact | Mitigation |
|------|------------|--------|-----------|
| go.mod circular dependencies | Low | High | Test `go mod graph`, verify no cycles |
| Docker build context issues | Medium | High | Test Dockerfile independently before integrating |
| Path issues in build scripts | High | Medium | Update Justfile incrementally, test locally |
| Shared code inconsistencies | Medium | Medium | Use go.mod replacement, verify imports |

## Timeline

| Phase | Task | Owner | Days |
|-------|------|-------|------|
| A | Directory setup + go.mod creation | Dev | 1 |
| B | Module validation + Justfile | Dev | 1 |
| C | Docker updates | Dev | 1 |
| D | Testing + verification | Dev | 1 |
| E | Documentation + commits | Dev | 1 |

**Total**: 5 days

## Next Steps After Completion

1. **Phase 2**: Extract proxy-data (1 week) - Medium risk
2. **Phase 3**: Move frontends to cc-viz (1 week) - Low risk
3. **Phase 4**: Workspace setup if needed (optional)

## Implementation Notes

- Keep it simple: Pure restructuring, zero code changes
- Focus on build verification at each step
- Commit frequently with atomic, meaningful commits
- Document go.mod replacement pattern for team learning
