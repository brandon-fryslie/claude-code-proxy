# Definition of Done: Model Breakdown Stats

**Generated**: 2025-12-24-223124
**Plan**: PLAN-2025-12-24-223124.md
**Epic**: brandon-fryslie_claude-code-proxy-xwb

---

## Sprint Scope

This sprint delivers:
1. ModelBreakdown component with horizontal bars
2. Model name and color utilities
3. Enhanced token formatting with B notation
4. Integration with Dashboard and Usage pages
5. Responsive styling
6. Sorted display (highest usage first)

Deferred: Percentage display (optional enhancement), historical comparison

---

## Acceptance Criteria

### ModelBreakdown Component
- [ ] Accepts `ModelStatsResponse` from API
- [ ] Renders one bar per model
- [ ] Shows model name (left-aligned)
- [ ] Shows token count (right-aligned)
- [ ] Bar width proportional to max (100% = highest)
- [ ] Uses model-specific colors
- [ ] Handles empty data ("No data" message)
- [ ] Sorted by token count (descending)
- [ ] Token counts use K/M notation

### Model Name Formatting
- [ ] `getModelDisplayName()` function created
- [ ] Maps "...opus..." → "Opus"
- [ ] Maps "...sonnet..." → "Sonnet"
- [ ] Maps "...haiku..." → "Haiku"
- [ ] Returns full string if no match
- [ ] Case-insensitive matching
- [ ] Placed in `lib/utils.ts`

### Model Color Mapping
- [ ] `getModelColor()` function created
- [ ] Returns #9333ea for opus
- [ ] Returns #3b82f6 for sonnet
- [ ] Returns #10b981 for haiku
- [ ] Returns #6b7280 as fallback
- [ ] Case-insensitive matching
- [ ] Placed in `lib/utils.ts`

### Token Formatting
- [ ] `formatTokens()` enhanced or created
- [ ] Returns plain number for < 1K
- [ ] Returns "X.XK" for 1K-999K
- [ ] Returns "X.XM" for 1M-999M
- [ ] Returns "X.XB" for ≥ 1B
- [ ] Uses 1 decimal place
- [ ] Handles 0 correctly
- [ ] Placed in `lib/utils.ts`

### Dashboard Integration
- [ ] Component imported in Dashboard.tsx
- [ ] Uses `useModelStats()` hook
- [ ] Passes date range params
- [ ] Shows loading state
- [ ] Shows error state
- [ ] Updates on refetch
- [ ] Positioned correctly in layout

### Usage Page Integration
- [ ] Component imported in Usage.tsx
- [ ] Uses `useModelStats()` hook
- [ ] Passes date range params
- [ ] Shows loading state
- [ ] Shows error state
- [ ] Updates on refetch
- [ ] Positioned below charts

### Styling
- [ ] Clear section title/header
- [ ] Adequate item spacing
- [ ] Consistent typography
- [ ] Right-aligned monospaced counts
- [ ] Subtle gray bar backgrounds
- [ ] Full-saturation model colors
- [ ] Rounded bar edges
- [ ] Hover state highlights
- [ ] Responsive layout
- [ ] Uses Tailwind classes

### Sorting
- [ ] Models sorted by tokens (desc)
- [ ] Sort maintained on updates
- [ ] Handles ties gracefully
- [ ] Handles empty array

### Testing
- [ ] Unit test: getModelDisplayName()
- [ ] Unit test: getModelColor()
- [ ] Unit test: formatTokens()
- [ ] Unit test: sorting logic
- [ ] Integration: renders with API data
- [ ] Integration: loading state
- [ ] Integration: error state
- [ ] Visual: compare with old dashboard
- [ ] Visual: verify colors
- [ ] Visual: verify proportions

### Code Quality
- [ ] TypeScript types defined
- [ ] No eslint warnings
- [ ] Component documented
- [ ] Follows new dashboard patterns
- [ ] Accessible (ARIA if needed)
- [ ] No console errors

---

## Implementation Checklist

### Phase 1: Utilities
- [ ] Create or enhance `lib/utils.ts`
- [ ] Add `getModelDisplayName()` function
- [ ] Add `getModelColor()` function
- [ ] Enhance `formatTokens()` with B notation
- [ ] Add unit tests for utilities

### Phase 2: Component
- [ ] Create `components/stats/ModelBreakdown.tsx`
- [ ] Implement bar layout with Tailwind
- [ ] Add model name + token count header
- [ ] Add proportional bar fill
- [ ] Sort models by usage
- [ ] Handle empty state

### Phase 3: Styling
- [ ] Add section title
- [ ] Style model items
- [ ] Style bar backgrounds
- [ ] Apply model colors to fills
- [ ] Add hover states
- [ ] Test responsive behavior

### Phase 4: Integration
- [ ] Import in Dashboard.tsx
- [ ] Connect to `useModelStats()` hook
- [ ] Add loading/error states
- [ ] Position in Dashboard layout
- [ ] Import in Usage.tsx
- [ ] Position in Usage layout

### Phase 5: Testing & QA
- [ ] Run unit tests
- [ ] Run integration tests
- [ ] Visual comparison with old dashboard
- [ ] Test with various data sets
- [ ] Test edge cases (no data, one model, etc)

---

## Verification Steps

1. **Compare with Old Dashboard**
   - Open old dashboard usage section
   - Open new dashboard usage page
   - Verify model names match
   - Verify token counts match
   - Verify relative bar widths match
   - Verify colors match

2. **Test Model Name Formatting**
   - Check opus models show "Opus"
   - Check sonnet models show "Sonnet"
   - Check haiku models show "Haiku"
   - Check unknown models show full name

3. **Test Token Formatting**
   - 500 → "500"
   - 1500 → "1.5K"
   - 1234567 → "1.2M"
   - 1500000000 → "1.5B"

4. **Test Sorting**
   - Highest usage model appears first
   - Lowest usage model appears last
   - Order consistent across refreshes

5. **Test States**
   - Loading state shows spinner/skeleton
   - Error state shows message
   - Empty state shows "No data"
   - Data state shows bars

6. **Test Responsive**
   - Desktop: bars display full width
   - Tablet: bars adjust width
   - Mobile: stacked layout

---

## Success Metrics

- [ ] Side-by-side comparison shows matching data
- [ ] All model bars render correctly
- [ ] Colors match conventions
- [ ] Bars scale proportionally
- [ ] No layout issues
- [ ] Component renders in <50ms
- [ ] Zero console errors/warnings
- [ ] Passes all unit tests
- [ ] Passes visual QA
