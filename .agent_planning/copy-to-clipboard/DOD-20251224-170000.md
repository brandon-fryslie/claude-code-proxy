# Definition of Done: Copy to Clipboard

**Generated**: 2025-12-24-170000
**Plan**: PLAN-20251224-170000.md
**Epic**: brandon-fryslie_claude-code-proxy-nhw

---

## Sprint Scope

This sprint delivers copy-to-clipboard functionality across the dashboard with consistent visual feedback and error handling.

**Deliverables**: 1 shared hook + 4 integration points (Request/Response JSON, Messages, Tool Results)

**Deferred**: Conversation copy (awaiting conversation-threads sprint), Batch copy (advanced feature), Keyboard shortcuts (P2)

---

## Acceptance Criteria

### useCopyToClipboard Hook

- [ ] Hook created at `dashboard/src/hooks/useCopyToClipboard.ts`
- [ ] Returns object: `{ copy: (text: string) => Promise<void>, copied: boolean, error: Error | null }`
- [ ] `copy()` function uses `navigator.clipboard.writeText()`
- [ ] Sets `copied` to true on success
- [ ] Resets `copied` to false after 2 seconds
- [ ] Stores error in `error` state on failure
- [ ] Logs errors to console for debugging
- [ ] Checks for clipboard API availability before use
- [ ] TypeScript types exported
- [ ] Unit test: Success path (copied becomes true)
- [ ] Unit test: Error path (error state set)
- [ ] Unit test: Timeout (copied resets after 2s)
- [ ] Unit test: Cleanup (timeout cleared on unmount)

### Request/Response JSON Copy

- [ ] Copy button added to request JSON section header
- [ ] Copy button added to response JSON section header
- [ ] Buttons use `useCopyToClipboard` hook
- [ ] Copy full request as formatted JSON (2-space indent)
- [ ] Copy full response as formatted JSON
- [ ] Copy icon (lucide-react) shown by default
- [ ] Check icon (green-400 or similar) shown for 2 seconds after copy
- [ ] Hover effect on button (hover:bg-gray-100 or similar)
- [ ] Tooltip: "Copy JSON" or "Copy to clipboard"
- [ ] Positioned in top-right of section header
- [ ] Works with large payloads (5000+ lines, 5MB)
- [ ] Integration test: Click copy request, verify JSON in clipboard
- [ ] Integration test: Click copy response, verify JSON in clipboard

### Message Content Copy

- [ ] Copy button added to text content blocks in MessageContent
- [ ] Button appears on hover (opacity-0 default, opacity-100 on hover)
- [ ] Copies plain text (strips HTML formatting if present)
- [ ] Uses `useCopyToClipboard` hook
- [ ] Shows Copy/Check icon transition
- [ ] Small button size (w-6 h-6 or similar)
- [ ] Positioned in top-right corner of message block (absolute positioning)
- [ ] Works with large messages (1000+ words)
- [ ] Does NOT appear on tool use/result blocks (they have their own)
- [ ] Unit test: Text extraction (strips HTML)
- [ ] Integration test: Hover message, click copy, verify text in clipboard

### Tool Result Copy

- [ ] Copy button added to ToolResult component header
- [ ] Copies raw content based on type:
  - Code: Extracted code without line numbers
  - JSON: Formatted JSON string
  - Text: Plain text
- [ ] Uses `useCopyToClipboard` hook
- [ ] Shows Copy/Check icon transition
- [ ] Positioned in top-right of result header
- [ ] Tooltip: "Copy result"
- [ ] Works with large results (5000+ lines)
- [ ] Unit test: Copy code content, verify raw code (no line numbers)
- [ ] Unit test: Copy JSON content, verify formatted JSON
- [ ] Unit test: Copy text content, verify plain text
- [ ] Integration test: Click copy on tool result, verify clipboard

---

## Testing Requirements

### Unit Test Coverage
- [ ] useCopyToClipboard hook: 90%+ coverage
- [ ] Copy formatting functions: 85%+ coverage (JSON stringify, text extraction)
- [ ] All unit tests pass

### Integration Tests
- [ ] Request JSON copy: Full flow (click → clipboard → feedback)
- [ ] Response JSON copy: Full flow
- [ ] Message copy: Hover → click → clipboard
- [ ] Tool result copy: All content types (code, JSON, text)

### Browser Compatibility
- [ ] Chrome: All copy features work
- [ ] Firefox: All copy features work
- [ ] Safari: All copy features work
- [ ] Fallback: Error message if clipboard API unavailable

### Performance
- [ ] 1MB JSON: Copies in < 100ms
- [ ] 5MB JSON: Copies in < 500ms (or shows size warning)
- [ ] No UI blocking during copy

### Code Quality
- [ ] 0 TypeScript errors
- [ ] 0 ESLint warnings
- [ ] Hook properly typed with TypeScript
- [ ] All components using hook have correct types

---

## Visual/UX Requirements

- [ ] Copy icon consistent across all locations (lucide-react Copy icon)
- [ ] Check icon consistent (green color, 2-second display)
- [ ] Button size appropriate for context (smaller on messages, larger on headers)
- [ ] Hover effects smooth (transition-colors or transition-opacity)
- [ ] Tooltip text clear and concise
- [ ] Mobile responsive (copy button usable on touch devices)
- [ ] Keyboard accessible (focusable, activatable with Enter/Space)

---

## Error Handling

- [ ] Clipboard API unavailable: Error logged, user-friendly message shown
- [ ] Copy operation fails: Error state set, error logged
- [ ] Large payloads: No UI freeze (tested with 5MB)
- [ ] Network errors: N/A (clipboard is local operation)

---

## Documentation

- [ ] useCopyToClipboard hook documented with JSDoc
- [ ] Usage examples provided in hook file or README
- [ ] Copy button components documented (prop types, behavior)

---

## Integration Points

- [ ] CodeViewer component: Copy button already implemented (code-viewer-highlighting sprint)
- [ ] ToolUse component: Copy button already implemented (message-content-parser sprint)
- [ ] RequestDetailContent: Copy buttons added for JSON
- [ ] MessageContent: Copy button added for text blocks
- [ ] ToolResult: Copy button added for results

---

## Deferred to Future Sprints

- [ ] Conversation copy (waiting for conversation-threads sprint)
- [ ] Batch copy (waiting for virtualized-request-list selection)
- [ ] Keyboard shortcuts (P2 priority)
- [ ] Copy with formatting (HTML/RTF)
- [ ] Copy history/clipboard manager

---

## Sprint Complete When

All acceptance criteria above are met AND:
- [ ] PR reviewed and approved
- [ ] All tests passing in CI
- [ ] Hook integrated into 4+ components
- [ ] Manual smoke test: Copy from 5 different locations
- [ ] Cross-browser testing completed (Chrome, Firefox, Safari)
- [ ] Performance verified (5MB payload)
