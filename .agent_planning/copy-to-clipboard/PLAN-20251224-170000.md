# Sprint Plan: Copy to Clipboard

**Generated**: 2025-12-24-170000
**Source**: STATUS-20251224.md (dashboard-parity evaluation)
**Epic**: brandon-fryslie_claude-code-proxy-nhw
**Topic**: copy-to-clipboard

---

## Sprint Goal

Add copy-to-clipboard functionality throughout the dashboard: code blocks, tool calls, tool results, request/response JSON, and any other copyable content with consistent visual feedback.

---

## Scope

### In Scope
- Copy buttons for code blocks (via CodeViewer - already implemented in code-viewer-highlighting sprint)
- Copy button for tool use blocks (already implemented in ToolUse component)
- Copy button for full request JSON
- Copy button for full response JSON
- Copy button for individual message content
- Shared copy utility hook or function
- Consistent visual feedback (checkmark, 2-second timeout)
- Error handling for clipboard API failures
- Keyboard shortcuts (Ctrl+C/Cmd+C support for focused elements)

### Out of Scope
- Copy as formatted text (HTML/RTF) - plain text only
- Copy with syntax highlighting preserved - raw text only
- Batch copy (multiple items at once)
- Copy history/clipboard manager
- Permission requests for clipboard access

---

## Work Items

### P0-1: Create Shared useCopyToClipboard Hook

**Status**: Not Started
**Complexity**: Low
**Dependencies**: None
**Spec Reference**: CLAUDE.md - Technical Patterns | **Status Reference**: STATUS-20251224.md lines 55-62

#### Description
Build a reusable React hook that encapsulates copy-to-clipboard logic with state management for success feedback and error handling.

#### Acceptance Criteria
- [ ] Hook created at `dashboard/src/hooks/useCopyToClipboard.ts`
- [ ] Hook returns: `{ copy: (text: string) => Promise<void>, copied: boolean, error: Error | null }`
- [ ] `copy()` function uses `navigator.clipboard.writeText()`
- [ ] Sets `copied` to true for 2 seconds after successful copy
- [ ] Resets `copied` to false after timeout
- [ ] Catches errors and stores in `error` state
- [ ] Logs errors to console for debugging
- [ ] TypeScript types exported
- [ ] Unit tests verify success and error paths
- [ ] Unit test verifies timeout resets copied state

#### Technical Notes
- Use `useState` for copied/error state
- Use `useCallback` for copy function to prevent re-renders
- Use `setTimeout` for 2-second reset, clean up on unmount
- Handle clipboard API not available (check `navigator.clipboard`)

---

### P0-2: Add Copy Button to RequestDetailContent

**Status**: Not Started
**Complexity**: Low
**Dependencies**: P0-1
**Spec Reference**: CLAUDE.md - Request Details | **Status Reference**: STATUS-20251224.md lines 35-36, 116

#### Description
Add copy buttons to the request details view: one for full request JSON, one for full response JSON, positioned in section headers.

#### Acceptance Criteria
- [ ] Copy button added to request JSON section header
- [ ] Copy button added to response JSON section header
- [ ] Buttons use `useCopyToClipboard` hook
- [ ] Copy full request object as formatted JSON (JSON.stringify with 2-space indent)
- [ ] Copy full response object as formatted JSON
- [ ] Shows Copy icon (lucide-react) by default
- [ ] Shows Check icon (green) for 2 seconds after success
- [ ] Button has hover effect (hover:bg-gray-100 or similar)
- [ ] Title tooltip: "Copy JSON" or "Copy to clipboard"
- [ ] Positioned in top-right of section header
- [ ] Works with large payloads (5000+ lines)
- [ ] Integration test: Click copy, verify JSON in clipboard

#### Technical Notes
- Find RequestDetailContent equivalent in new dashboard (likely in Requests.tsx)
- Use `formatJSON()` utility from formatters to ensure consistent formatting
- Position button with flexbox: `flex justify-between` on header

---

### P0-3: Add Copy Button to Individual Messages

**Status**: Not Started
**Complexity**: Low
**Dependencies**: P0-1, message-content-parser sprint
**Spec Reference**: CLAUDE.md - Message Rendering | **Status Reference**: STATUS-20251224.md lines 112-119

#### Description
Add a subtle copy button to each text message block, allowing users to copy message content without tool metadata or formatting.

#### Acceptance Criteria
- [ ] Copy button added to text content blocks in MessageContent component
- [ ] Button appears on hover (hover:opacity-100, default opacity-0 or 50)
- [ ] Copies plain text content (strips HTML formatting)
- [ ] Uses `useCopyToClipboard` hook
- [ ] Shows Copy/Check icon transition
- [ ] Button positioned in top-right corner of message block
- [ ] Small size (w-6 h-6 or similar) to not distract from content
- [ ] Works with large messages (1000+ words)
- [ ] Does NOT appear on non-text content (images, tool calls)
- [ ] Unit test: Verify text content copied correctly
- [ ] Integration test: Hover message, click copy, verify clipboard

#### Technical Notes
- Use `position: relative` on message container, `position: absolute` on button
- Extract plain text from formatted content (strip HTML tags if present)
- Consider adding to text blocks only, not tool use/result blocks (they have their own copy)

---

### P1-4: Add Copy to ToolResult Component

**Status**: Not Started
**Complexity**: Low
**Dependencies**: P0-1, message-content-parser sprint
**Spec Reference**: CLAUDE.md - Tool Result Display | **Status Reference**: STATUS-20251224.md lines 45-50, 119

#### Description
Add copy button to tool result blocks, copying the raw result content (code, JSON, or text) without metadata or styling.

#### Acceptance Criteria
- [ ] Copy button added to ToolResult component header
- [ ] Copies raw content (not formatted/highlighted version)
- [ ] For code content: Copies extracted code (without line numbers)
- [ ] For JSON content: Copies formatted JSON
- [ ] For text content: Copies plain text
- [ ] Uses `useCopyToClipboard` hook
- [ ] Shows Copy/Check icon transition
- [ ] Button positioned in top-right of result header
- [ ] Tooltip: "Copy result"
- [ ] Works with large results (5000+ lines)
- [ ] Unit test: Verify correct content copied for each content type
- [ ] Integration test: Click copy on code result, verify raw code in clipboard

#### Technical Notes
- ToolResult component already detects content type (code/JSON/text)
- Use same content extraction logic for copy as for display
- Ensure code copied without cat -n line numbers (use extractedCode)

---

### P1-5: Add Copy to Conversation Thread

**Status**: Not Started
**Complexity**: Low
**Dependencies**: P0-1, conversation-threads sprint (Phase 2)
**Spec Reference**: CLAUDE.md - Conversation View | **Status Reference**: STATUS-20251224.md lines 35, 38, 132

#### Description
Add copy functionality to conversation thread view, allowing users to copy the entire conversation as text or individual messages.

#### Acceptance Criteria
- [ ] Copy button added to conversation thread header (copies entire conversation)
- [ ] Copies all messages in thread as plain text with role labels
- [ ] Format: "User: [message]\n\nAssistant: [message]\n\n..."
- [ ] Uses `useCopyToClipboard` hook
- [ ] Shows Copy/Check icon transition
- [ ] Button positioned in conversation header
- [ ] Tooltip: "Copy conversation"
- [ ] Works with long conversations (100+ messages)
- [ ] Unit test: Verify conversation format
- [ ] Integration test: Copy conversation, verify format in clipboard

#### Technical Notes
- This depends on conversation-threads sprint being completed
- May be deferred if conversation view not yet implemented
- Consider adding copy to individual messages in thread as well

---

### P2-6: Add Keyboard Shortcuts for Copy

**Status**: Not Started
**Complexity**: Medium
**Dependencies**: P0-1, P0-2, P0-3
**Spec Reference**: CLAUDE.md - Technical Patterns | **Status Reference**: STATUS-20251224.md lines 55-62

#### Description
Add keyboard shortcuts (Ctrl+C / Cmd+C) to copy focused content, improving accessibility and power-user workflow.

#### Acceptance Criteria
- [ ] Keyboard listener added to relevant components
- [ ] Ctrl+C (Windows/Linux) or Cmd+C (Mac) triggers copy
- [ ] Only triggers when component is focused (not when text is selected)
- [ ] Does NOT interfere with native text selection copy
- [ ] Shows same visual feedback as button click (copied state)
- [ ] Works for: Request JSON, Response JSON, Messages, Tool Results
- [ ] Accessible via tab navigation (components focusable)
- [ ] Unit test: Simulate keyboard event, verify copy triggered
- [ ] Integration test: Focus component, press Ctrl+C, verify clipboard

#### Technical Notes
- Use `useEffect` with `addEventListener('keydown')` on window or component
- Check `event.ctrlKey || event.metaKey` and `event.key === 'c'`
- Check `window.getSelection().toString()` - if non-empty, don't intercept (allow native copy)
- Consider adding visual indicator for keyboard focus (ring-2 ring-blue-500)

---

### P2-7: Add Batch Copy for Multiple Requests

**Status**: Not Started
**Complexity**: Medium
**Dependencies**: P0-1, virtualized-request-list sprint (Phase 1)
**Spec Reference**: CLAUDE.md - Request List | **Status Reference**: STATUS-20251224.md lines 34, 114

#### Description
Allow users to select multiple requests from the list and copy their IDs or metadata as a batch operation.

#### Acceptance Criteria
- [ ] Checkbox added to each request in virtualized list
- [ ] "Select all" checkbox in list header
- [ ] Copy button appears when 1+ requests selected
- [ ] Copies selected request IDs as newline-separated list
- [ ] Alternatively: Copies as JSON array of request metadata objects
- [ ] Uses `useCopyToClipboard` hook
- [ ] Shows count of selected items (e.g., "Copy 5 requests")
- [ ] Clear selection after copy (optional)
- [ ] Works with 100+ selected requests
- [ ] Unit test: Select multiple, copy, verify format
- [ ] Integration test: Select 10 requests, copy IDs, verify clipboard

#### Technical Notes
- This requires selection state management in request list
- May be out of scope for MVP - consider deferring
- Alternative: Just copy visible request list as CSV/JSON

---

## Dependencies

```
P0-1 (useCopyToClipboard hook)
  ├─> P0-2 (Request/Response JSON copy)
  ├─> P0-3 (Message copy)
  ├─> P1-4 (Tool result copy)
  ├─> P1-5 (Conversation copy - depends on conversation-threads sprint)
  ├─> P2-6 (Keyboard shortcuts)
  └─> P2-7 (Batch copy - depends on request list)
```

**Critical Path**: P0-1 → P0-2, P0-3, P1-4

**External Dependencies**:
- message-content-parser sprint (for P0-3, P1-4)
- conversation-threads sprint (for P1-5)
- virtualized-request-list sprint (for P2-7)

---

## Recommended Sprint Sequence

### Week 1: Core Copy Functionality
1. **Day 1**: Create `useCopyToClipboard` hook (P0-1) with tests
2. **Day 2**: Add to Request/Response JSON (P0-2)
3. **Day 3**: Add to Messages (P0-3) - may need to wait for message-content-parser
4. **Day 4**: Add to Tool Results (P1-4)
5. **Day 5**: Testing and bug fixes

### Week 2: Advanced Features (Optional)
1. **Day 1-2**: Keyboard shortcuts (P2-6)
2. **Day 3**: Conversation copy (P1-5) - if conversation view ready
3. **Day 4-5**: Batch copy (P2-7) - if request list ready, or defer

**Total Complexity**: LOW-MEDIUM (mostly UI integration of shared hook)

---

## Risk Assessment

### High Risks
1. **Clipboard API Availability**: May not work in some browsers/contexts (HTTP, old browsers)
   - **Mitigation**: Check for API availability, show error message if unavailable
   - **Impact**: Copy feature broken for some users

2. **Large Payload Performance**: Copying 10MB JSON could freeze UI
   - **Mitigation**: Test with large payloads, add size warning if needed
   - **Impact**: Poor UX for very large requests

### Medium Risks
1. **Keyboard Shortcut Conflicts**: Ctrl+C might interfere with text selection
   - **Mitigation**: Check if text is selected before intercepting
   - **Impact**: Native copy broken in some cases

2. **External Sprint Dependencies**: P0-3 and P1-4 depend on message-content-parser sprint
   - **Mitigation**: Prioritize P0-2 first, implement P0-3/P1-4 after message components ready
   - **Impact**: Sprint blocked until dependencies complete

### Low Risks
1. **Visual Feedback Timing**: 2-second timeout might be too short/long
   - **Mitigation**: User testing, make timeout configurable
   - **Impact**: Minor UX issue

---

## Testing Strategy

### Unit Tests
- `useCopyToClipboard`: Success path, error path, timeout reset
- Copy formatting: JSON stringify, text extraction, conversation formatting
- Keyboard shortcuts: Event handling, selection detection
- Error handling: Clipboard API unavailable

### Integration Tests
- Request JSON copy: Click button, verify JSON in clipboard
- Message copy: Hover, click, verify text content
- Tool result copy: Copy code/JSON/text, verify correct format
- Keyboard shortcuts: Focus, press Ctrl+C, verify copy
- Large payload: Copy 5MB JSON, verify no UI freeze

### Browser Compatibility Tests
- Chrome: All features work
- Firefox: All features work
- Safari: All features work
- HTTP context: Clipboard API fallback or error message

---

## Blockers and Questions

### Questions for Product Owner
1. **Copy Format for Conversations**: Plain text with role labels, or JSON structure?
   - **Options**: "User: ...\nAssistant: ..." vs JSON array
   - **Recommendation**: Plain text for readability

2. **Batch Copy Priority**: Should we implement batch copy in this sprint, or defer?
   - **Impact**: Requires selection UI in request list
   - **Recommendation**: Defer to Phase 2 (advanced features)

3. **Large Payload Warnings**: Should we warn users before copying 1MB+ content?
   - **Impact**: Prevents accidental UI freeze
   - **Recommendation**: Add size check, show confirmation modal for 5MB+

### Technical Decisions Needed
1. **Hook Location**: `dashboard/src/hooks/` or `dashboard/src/lib/`?
   - **Recommendation**: `hooks/` for React hooks

2. **Copy Button Styling**: Consistent across all locations (same size, colors, position)?
   - **Recommendation**: Create shared CopyButton component wrapping the hook

3. **Keyboard Shortcuts**: Global listener or per-component?
   - **Recommendation**: Per-component to avoid conflicts, use ref for focus detection

---

## Definition of Done

See: `DOD-20251224-170000.md`

---

## Success Metrics

### Functional Completeness
- [ ] Copy works in 5+ locations (Request JSON, Response JSON, Messages, Tool Results, Code)
- [ ] Visual feedback consistent (2-second checkmark)
- [ ] Keyboard shortcuts work for focused elements
- [ ] Error handling graceful (clipboard API unavailable)

### Performance
- [ ] 1MB JSON copies in < 100ms
- [ ] 5MB JSON copies in < 500ms (or shows warning)
- [ ] No UI blocking during copy operation

### Quality
- [ ] 80%+ unit test coverage for hook
- [ ] 0 TypeScript errors
- [ ] 0 ESLint warnings
- [ ] Works in Chrome, Firefox, Safari

### User Experience
- [ ] Copy feedback visible (green checkmark)
- [ ] Tooltip explains what will be copied
- [ ] Keyboard accessible (tab + enter or Ctrl+C)
- [ ] Mobile responsive (copy button visible on touch)
