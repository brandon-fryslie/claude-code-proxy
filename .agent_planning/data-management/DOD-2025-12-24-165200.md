# Definition of Done: Data Management

**Generated**: 2025-12-24-165200
**Plan**: PLAN-2025-12-24-165200.md

---

## Acceptance Criteria

### Manual Refresh Button for Request List
- [ ] Refresh button (RefreshCw icon) visible in Requests page header
- [ ] Click triggers immediate refetch of request list data
- [ ] Button shows spinning animation during refresh
- [ ] Button disabled while refresh in progress
- [ ] Request list updates immediately after successful refresh
- [ ] Error toast shown if refresh fails
- [ ] Keyboard shortcut (Cmd/Ctrl+R) triggers refresh
- [ ] Unit test: Refresh action invalidates correct TanStack Query cache keys
- [ ] E2E test: Click refresh → loading state → updated list

### Manual Refresh for Stats/Analytics
- [ ] Refresh button on Dashboard page header
- [ ] Refresh button on Usage page header
- [ ] Refresh button on Performance page header
- [ ] Refresh button on Routing page header
- [ ] All related queries invalidated simultaneously (stats, hourly, models, providers)
- [ ] Charts update smoothly after refresh (no flicker)
- [ ] Last refresh timestamp displayed (e.g., "Updated 2m ago")
- [ ] Unit test: Refresh invalidates all required query keys
- [ ] E2E test: Refresh dashboard → all stats update

### Clear All Requests with Confirmation
- [ ] "Clear All Requests" button in Settings page or Requests page header
- [ ] Click opens confirmation modal with warning message
- [ ] Confirmation modal requires typing "DELETE" or similar to confirm
- [ ] Cancel button closes modal without action
- [ ] Confirm triggers `DELETE /api/requests` API call
- [ ] Success shows toast notification and redirects to empty state
- [ ] Error shows toast with error details
- [ ] Request list and stats refresh automatically after clear
- [ ] Button disabled during delete operation
- [ ] Unit test: Confirmation flow prevents accidental deletion
- [ ] E2E test: Confirm deletion → all requests cleared → empty state shown

### Auto-Refresh Toggle in Settings
- [ ] Settings page has "Auto-Refresh" toggle switch
- [ ] Toggle state persisted in localStorage
- [ ] Toggle state loads on app initialization
- [ ] Visual indicator when auto-refresh is active (e.g., pulsing icon in header)
- [ ] Turning on auto-refresh immediately starts refresh timer
- [ ] Turning off auto-refresh stops refresh timer
- [ ] Setting applies to all pages (requests, dashboard, stats)
- [ ] Unit test: Toggle state correctly saved/loaded from localStorage
- [ ] E2E test: Enable auto-refresh → data refreshes automatically

### Auto-Refresh Interval Configuration
- [ ] Settings page has interval selector (radio buttons or dropdown)
- [ ] Options: 30 seconds, 1 minute, 5 minutes, 10 minutes
- [ ] Selected interval persisted in localStorage
- [ ] Interval applies to all auto-refresh queries
- [ ] Changing interval while auto-refresh active immediately updates timer
- [ ] Default interval: 1 minute
- [ ] Visual indicator shows current interval (e.g., "Auto-refresh: ON (1m)")
- [ ] Unit test: Interval value correctly saved/loaded
- [ ] E2E test: Change interval → verify refresh happens at new interval

### Refresh All Data Global Action
- [ ] "Refresh All" button in main app header/toolbar
- [ ] Click invalidates all TanStack Query caches
- [ ] Loading state shown globally (progress bar or overlay)
- [ ] All pages update after refresh completes
- [ ] Keyboard shortcut (Cmd/Ctrl+Shift+R) triggers global refresh
- [ ] Success toast notification shown
- [ ] Unit test: Global refresh invalidates all query keys
- [ ] E2E test: Navigate to different pages → global refresh → all data updated

### Last Refresh Timestamp Display
- [ ] Timestamp displayed on Requests, Dashboard, Usage, Performance, Routing pages
- [ ] Timestamp updates after manual refresh
- [ ] Timestamp updates after auto-refresh
- [ ] Format: "Updated Xm ago" or "Updated Xs ago"
- [ ] Tooltip shows absolute timestamp (e.g., "2025-12-24 16:52:00")
- [ ] Timestamp updates in real-time (every 10s) without refetching data
- [ ] Unit test: Timestamp calculation accurate
- [ ] E2E test: Refresh → timestamp updates

### Request Count Before Clear
- [ ] Confirmation modal displays: "Delete X requests?"
- [ ] Count fetched from backend or derived from current request list
- [ ] Count accurate at time of modal open (not stale)
- [ ] Warning message severity increases with count (e.g., >1000 shows red warning)
- [ ] Unit test: Count displayed matches actual request count
- [ ] E2E test: Open modal → count shown → cancel → count unchanged

---

## Sprint Scope

**This sprint delivers**:
1. Manual refresh for all pages (requests, stats, analytics)
2. Clear all requests with confirmation
3. Auto-refresh settings with configurable interval

**Deferred**:
- Selective request deletion (delete by filter/date)
- Data export before clear
- Undo for clear operations
- Database optimization tools
- Data retention policies
