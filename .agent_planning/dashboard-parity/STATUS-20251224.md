# Dashboard Feature Parity Evaluation

**Timestamp**: 2025-12-24-164500
**Scope**: Comparison between old dashboard (web/) and new dashboard (dashboard/)
**Confidence**: FRESH

---

## Executive Summary

**Status**: New dashboard has ~40% feature parity with old dashboard. Core infrastructure is in place, but significant features are missing.

**Old Dashboard** (`web/`):
- Single-page Remix app with 1,260 line main component
- 13 detailed UI components (6,013 total LOC)
- Rich request inspection, comparison, and conversation analysis
- Virtualized list handling for 1000s of requests
- Advanced usage analytics with weekly/daily/hourly breakdowns

**New Dashboard** (`dashboard/`):
- Multi-page React Router + TanStack Query app
- 7 pages with cleaner separation of concerns
- Basic request viewing and stats
- Missing most advanced features

---

## Old Dashboard Feature Inventory

### 1. Core Features (Implemented)

| Feature | Location | Description |
|---------|----------|-------------|
| **Request List** | `_index.tsx` | Virtualized list with @tanstack/react-virtual |
| **Request Details** | `RequestDetailContent.tsx` (1,023 LOC) | Full request/response inspection with expandable sections |
| **Usage Dashboard** | `UsageDashboard.tsx` (451 LOC + CSS) | Weekly + hourly charts, model breakdown |
| **Conversation View** | `ConversationThread.tsx` (202 LOC) | JSONL conversation log parsing and display |
| **Message Rendering** | `MessageContent.tsx` (399 LOC) | Rich message content with tool calls, images, code |

### 2. Advanced Features (Old Dashboard Only)

| Feature | Component | LOC | Description |
|---------|-----------|-----|-------------|
| **Request Comparison** | `RequestCompareModal.tsx` | 1,152 | Side-by-side diff of 2 requests |
| **Code Viewer** | `CodeViewer.tsx` | 264 | Syntax highlighting, language detection |
| **Code Diff** | `CodeDiff.tsx` | 102 | Line-by-line code comparison |
| **Message Flow** | `MessageFlow.tsx` | 281 | Visual conversation flow diagram |
| **Tool Use Display** | `ToolUse.tsx` | 208 | Tool call visualization |
| **Tool Result Display** | `ToolResult.tsx` | 256 | Tool response formatting |
| **Image Display** | `ImageContent.tsx` | 143 | Base64 image rendering |
| **Todo List Rendering** | `TodoList.tsx` | 189 | Parse and display Claude Code todos |
| **Prompt Grading** | `api.grade-prompt.tsx` | - | AI-powered prompt evaluation |

### 3. Technical Patterns

**Old Dashboard**:
- **Virtualization**: `@tanstack/react-virtual` for handling 1000s of requests efficiently
- **Lazy Loading**: Request details loaded on-demand, cached in Map
- **Date Navigation**: Week-aware navigation (Sunday-Saturday), avoids refetching same week
- **Model Filtering**: Per-model request filtering (opus/sonnet/haiku)
- **Compare Mode**: Select 2 requests, compare side-by-side with diffs
- **Streaming**: Displays streaming chunks from SSE responses

**New Dashboard**:
- **TanStack Query**: Modern data fetching with caching
- **React Router**: Route-based navigation vs. modal-based
- **Recharts**: Charts vs. custom CSS charts
- **Resizable Panels**: Split-pane layout for list/detail views

---

## New Dashboard Feature Inventory

### Implemented Pages

| Page | File | LOC | Status | Notes |
|------|------|-----|--------|-------|
| **Dashboard** | `Dashboard.tsx` | 206 | ✅ BASIC | Simple stats cards + 2 charts |
| **Requests** | `Requests.tsx` | 243 | ⚠️ PARTIAL | List + detail, missing rich rendering |
| **Conversations** | `Conversations.tsx` | 187 | ⚠️ STUB | Minimal implementation |
| **Usage** | `Usage.tsx` | 196 | ⚠️ PARTIAL | Charts present, missing weekly breakdown |
| **Performance** | `Performance.tsx` | 176 | ✅ NEW | P50/P95/P99 stats (not in old dashboard!) |
| **Routing** | `Routing.tsx` | 175 | ✅ NEW | Subagent routing stats (new feature) |
| **Settings** | `Settings.tsx` | 67 | ❌ STUB | Placeholder only |

### API Integration

**New Dashboard** has cleaner API abstraction:
- `lib/api.ts` (196 LOC): Centralized TanStack Query hooks
- Supports 10+ endpoints:
  - `/api/requests/summary` ✅
  - `/api/requests/{id}` ✅
  - `/api/stats` ✅
  - `/api/stats/hourly` ✅
  - `/api/stats/models` ✅
  - `/api/stats/providers` ✅ (NEW)
  - `/api/stats/subagents` ✅ (NEW)
  - `/api/stats/tools` ✅ (NEW)
  - `/api/stats/performance` ✅ (NEW)
  - `/api/conversations` ⚠️ (different structure)

**Old Dashboard**:
- Remix loaders for API proxying to Go backend
- Direct fetch calls with manual caching

---

## Feature Gap Analysis

### Critical Gaps (Must Have)

| Feature | Old | New | Blocker? | Complexity |
|---------|-----|-----|----------|------------|
| **Virtualized Request List** | ✅ | ❌ | YES | Medium - needs @tanstack/react-virtual |
| **Rich Message Rendering** | ✅ | ❌ | YES | High - 399 LOC component + 8 sub-components |
| **Request Detail Sections** | ✅ | ❌ | YES | High - expandable sections, metadata |
| **Code Syntax Highlighting** | ✅ | ❌ | YES | Medium - language detection + highlighting |
| **Tool Call Visualization** | ✅ | ❌ | YES | Medium - ToolUse + ToolResult components |
| **Image Display** | ✅ | ❌ | Medium | Low - Base64 rendering |
| **Week-Aware Navigation** | ✅ | ❌ | Medium | Medium - date boundary logic |
| **Model Filtering** | ✅ | ❌ | Medium | Low - filter UI already exists |

### Advanced Gaps (Nice to Have)

| Feature | Old | New | Priority | Complexity |
|---------|-----|-----|----------|------------|
| **Request Comparison** | ✅ | ❌ | High | Very High - 1,152 LOC |
| **Code Diff Viewer** | ✅ | ❌ | High | Medium - 102 LOC |
| **Message Flow Diagram** | ✅ | ❌ | Medium | High - 281 LOC |
| **Todo List Rendering** | ✅ | ❌ | Low | Low - 189 LOC |
| **Prompt Grading** | ✅ | ❌ | Low | Medium - API integration |
| **Conversation Thread** | ✅ | ⚠️ | High | High - JSONL parsing |

### New Features (Not in Old)

| Feature | Status | Value |
|---------|--------|-------|
| **Performance Stats (P50/P95/P99)** | ✅ COMPLETE | High |
| **Provider Stats** | ✅ COMPLETE | High |
| **Subagent Routing Stats** | ✅ COMPLETE | High |
| **Tool Usage Stats** | ✅ COMPLETE | Medium |
| **Resizable Panels** | ✅ COMPLETE | Medium |
| **Dark Mode Support** | ✅ COMPLETE | Low |

---

## Component Comparison

### Old Dashboard Components

```
web/app/components/
├── CodeDiff.tsx              102 LOC  - Line-by-line diff
├── CodeViewer.tsx            264 LOC  - Syntax highlighting
├── ConversationThread.tsx    202 LOC  - Conversation parsing
├── ImageContent.tsx          143 LOC  - Image rendering
├── MessageContent.tsx        399 LOC  - Main message renderer
├── MessageFlow.tsx           281 LOC  - Flow diagram
├── RequestCompareModal.tsx  1152 LOC  - Request comparison
├── RequestDetailContent.tsx 1023 LOC  - Request details
├── TodoList.tsx              189 LOC  - Todo rendering
├── ToolResult.tsx            256 LOC  - Tool result display
├── ToolUse.tsx               208 LOC  - Tool call display
└── UsageDashboard.tsx        451 LOC  - Usage charts
Total: 4,670 LOC in reusable components
```

### New Dashboard Components

```
dashboard/src/components/
└── layout/
    ├── AppLayout.tsx          54 LOC  - Layout wrapper
    ├── ResizablePanel.tsx    [?] LOC  - Split panes
    └── Sidebar.tsx           [?] LOC  - Navigation
Total: ~200 LOC (estimated)
```

**Gap**: New dashboard missing ~4,500 LOC of UI components!

---

## Architecture Comparison

### Old Dashboard (Remix)

**Pros**:
- All features in one place - easy to find
- Server-side rendering capability
- Mature ecosystem

**Cons**:
- 1,260 line monolithic component
- Manual state management
- No route-based navigation
- Harder to test individual features

### New Dashboard (React Router + TanStack Query)

**Pros**:
- Clean separation: 7 pages vs 1 monolith
- Modern data fetching with caching
- Route-based navigation
- Better testability
- Type-safe API layer

**Cons**:
- Missing most UI components
- Less feature-complete
- More files to manage

---

## Data Flow Verification

### Request List → Detail Flow

**Old Dashboard**:
1. Load summaries: `GET /api/requests/summary?start=...&end=...`
2. Render virtualized list (all items, only visible rendered)
3. On click: `GET /api/requests/{id}` → cache in Map
4. Show modal with `RequestDetailContent`

**New Dashboard**:
1. Load summaries: `GET /api/requests/summary?limit=100` (hardcoded!)
2. Render all 100 items (no virtualization)
3. On click: `GET /api/requests/{id}` → TanStack Query cache
4. Show in right pane with basic JSON display

**Issues**:
- ❌ No virtualization (won't scale to 1000s of requests)
- ❌ No message content rendering
- ❌ No tool call visualization
- ❌ No code highlighting

### Stats Flow

**Old Dashboard**:
1. Week boundaries: Calculate Sunday-Saturday
2. Parallel fetch: `/api/stats`, `/api/stats/hourly`, `/api/stats/models`
3. Smart refetch: Same week? Only hourly. New week? Fetch all.
4. Custom CSS charts with stacked model breakdowns

**New Dashboard**:
1. Today only: `getTodayDateRange()`
2. Parallel fetch: Multiple endpoints
3. Always refetch everything
4. Recharts library for visualization

**Issues**:
- ❌ No week navigation
- ❌ No date navigation
- ❌ Missing stacked model charts
- ❌ Less efficient refetching

---

## API Coverage

| Endpoint | Old Dashboard | New Dashboard | Backend Exists? |
|----------|---------------|---------------|-----------------|
| `/api/requests/summary` | ✅ | ✅ | ✅ |
| `/api/requests/{id}` | ✅ | ✅ | ✅ |
| `/api/requests/latest-date` | ✅ | ✅ | ✅ |
| `/api/stats` | ✅ | ✅ | ✅ |
| `/api/stats/hourly` | ✅ | ✅ | ✅ |
| `/api/stats/models` | ✅ | ✅ | ✅ |
| `/api/stats/providers` | ❌ | ✅ | ✅ |
| `/api/stats/subagents` | ❌ | ✅ | ✅ |
| `/api/stats/tools` | ❌ | ✅ | ✅ |
| `/api/stats/performance` | ❌ | ✅ | ✅ |
| `/api/conversations` | ✅ | ✅ | ✅ (different) |
| `/api/grade-prompt` | ✅ | ❌ | ✅ |

---

## Dependency Analysis

### Old Dashboard Dependencies

```json
{
  "@remix-run/node": "^2.16.8",
  "@remix-run/react": "^2.16.8",
  "@tanstack/react-virtual": "^3.13.12",  // Virtualization
  "lucide-react": "^0.522.0",
  "react": "^18.2.0"
}
```

**Total**: 5 core dependencies + dev tools

### New Dashboard Dependencies

```json
{
  "@tanstack/react-query": "^5.90.12",    // Data fetching
  "@tanstack/react-router": "^1.143.4",   // Routing
  "lucide-react": "^0.562.0",
  "react": "^19.2.0",                     // React 19!
  "recharts": "^3.6.0",                   // Charts
  "tailwind-merge": "^3.4.0"
}
```

**Total**: 6 core dependencies + dev tools

**Missing from New**:
- `@tanstack/react-virtual` - needed for request list virtualization

---

## Testing Coverage

### Old Dashboard

- `CodeViewer.test.tsx`: Basic syntax highlighting tests
- Manual testing for UI components

### New Dashboard

- ❌ No tests found

---

## Recommendations

### Phase 1: Core Parity (Critical Path)

1. **Add Virtualization to Request List** (1-2 days)
   - Install `@tanstack/react-virtual`
   - Replace flat list rendering in `Requests.tsx`
   - Test with 1000+ requests

2. **Build Rich Message Renderer** (3-4 days)
   - Port `MessageContent.tsx` (399 LOC)
   - Port `ToolUse.tsx` (208 LOC)
   - Port `ToolResult.tsx` (256 LOC)
   - Port `ImageContent.tsx` (143 LOC)
   - Total: ~1,000 LOC to port

3. **Add Code Syntax Highlighting** (1-2 days)
   - Port `CodeViewer.tsx` (264 LOC)
   - Choose highlighting library (Prism.js? Shiki?)

4. **Implement Date Navigation** (2-3 days)
   - Add week-boundary logic
   - Add date picker UI
   - Update stats fetching to match old behavior
   - Add "snap to latest date" feature

5. **Add Model Filtering** (1 day)
   - UI already exists in old dashboard
   - Wire up to requests API

**Total Phase 1**: ~10-14 days of work

### Phase 2: Advanced Features (Nice to Have)

6. **Request Comparison** (3-5 days)
   - Port `RequestCompareModal.tsx` (1,152 LOC)
   - Port `CodeDiff.tsx` (102 LOC)
   - Add selection UI

7. **Conversation Thread** (2-3 days)
   - Port `ConversationThread.tsx` (202 LOC)
   - Port `MessageFlow.tsx` (281 LOC)
   - Update API integration

8. **Todo List Rendering** (1 day)
   - Port `TodoList.tsx` (189 LOC)

9. **Prompt Grading** (2 days)
   - Integrate `/api/grade-prompt` endpoint
   - Add UI for triggering/displaying grades

**Total Phase 2**: ~8-11 days of work

### Phase 3: Polish & Optimization

10. **Testing** (3-5 days)
    - Unit tests for components
    - Integration tests for data flows
    - E2E tests for critical paths

11. **Performance** (2-3 days)
    - Benchmark virtualization
    - Optimize chart rendering
    - Add loading states

12. **Documentation** (2 days)
    - Component usage docs
    - Architecture decision records

**Total Phase 3**: ~7-10 days

---

## Total Effort Estimate

| Phase | Days | Risk |
|-------|------|------|
| Phase 1 (Core Parity) | 10-14 | Medium |
| Phase 2 (Advanced) | 8-11 | High |
| Phase 3 (Polish) | 7-10 | Low |
| **Total** | **25-35 days** | Medium-High |

**Complexity**: HIGH
- 4,500+ LOC to port
- Complex state management
- Data flow differences
- Need to maintain both dashboards during transition?

---

## Ambiguities & Questions

### 1. Migration Strategy

**Question**: Should we maintain both dashboards during transition, or hard-cut?

**Options**:
- **A**: Keep both, link between them (current state)
  - Pros: Low risk, gradual migration
  - Cons: Double maintenance, user confusion

- **B**: Feature-flag controlled rollout
  - Pros: Single codebase, A/B testing possible
  - Cons: More complex, need feature flags

- **C**: Hard cutover when new reaches parity
  - Pros: Clean break, no split maintenance
  - Cons: All-or-nothing risk

**Impact**: Affects development timeline and risk

### 2. Component Reuse

**Question**: Can we extract components to a shared library, or must we port?

**Issue**: Old uses Remix, new uses React Router. Some components are tightly coupled.

**Options**:
- Port everything (clean, but duplicate effort)
- Extract to shared lib (complex dependency management)

### 3. Backend API Changes

**Question**: Do we need to change Go backend APIs to support new features?

**Observation**: New dashboard already has new endpoints (`/stats/providers`, `/stats/subagents`, etc.)

**Action Needed**: Verify all old dashboard endpoints still work with new structure

### 4. Chart Library Choice

**Question**: Keep Recharts or switch to old dashboard's custom CSS charts?

**Tradeoffs**:
- Recharts: Feature-rich, maintained, larger bundle
- Custom CSS: Lightweight, exact control, more code to maintain

### 5. Conversation API Mismatch

**Question**: Old dashboard expects different conversation structure than new API provides

**Evidence**:
- Old: Loads from `/api/conversations/{id}?project=...`
- New: Different data structure in `types.ts`

**Action Needed**: Align on conversation data model

---

## Blockers

### Hard Blockers (Must Fix)

1. **No virtualization** - Will fail with large request lists
2. **No message content rendering** - Core feature unusable
3. **No code highlighting** - Developer tool without code view?

### Soft Blockers (Workarounds Exist)

1. **No request comparison** - Can open 2 tabs
2. **No week navigation** - Can view today only
3. **No conversation thread** - Can view requests individually

---

## Verdict

**Status**: ⚠️ CONTINUE - Gaps are clear, implementer can proceed

**Recommendation**: Proceed with Phase 1 (Core Parity) implementation.

**Confidence**: HIGH
- All gaps documented with LOC estimates
- Clear dependency requirements
- Data flow verified
- API coverage mapped

**Next Steps**:
1. Answer migration strategy question (#1 above)
2. Create detailed implementation plan for Phase 1
3. Set up component testing infrastructure
4. Begin virtualization implementation

**Risk Assessment**:
- **Technical Risk**: MEDIUM - straightforward porting, no new architecture
- **Timeline Risk**: MEDIUM-HIGH - 25-35 days is substantial
- **Quality Risk**: LOW - can test against old dashboard as reference

---

## Appendix: File Counts

### Old Dashboard Structure
```
web/app/
├── components/      13 files, 4,670 LOC
├── routes/          10 files (1 main + 9 API)
└── utils/           2 files
```

### New Dashboard Structure
```
dashboard/src/
├── components/      ~3 files, ~200 LOC
├── pages/           7 files, ~1,400 LOC
├── lib/             3 files (api, types, utils)
└── router.tsx       1 file, 113 LOC
```

**Code volume**: Old dashboard has ~3x more UI code, but new has better organization.
