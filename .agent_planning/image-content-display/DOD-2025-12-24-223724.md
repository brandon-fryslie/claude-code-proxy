# Definition of Done: Image Content Display

**Generated**: 2025-12-24-223724
**Plan**: PLAN-2025-12-24-223724.md
**Epic**: brandon-fryslie_claude-code-proxy-asz

---

## Acceptance Criteria

### Base ImageContent Component
- [ ] Component accepts content prop with image data structure
- [ ] Component extracts imageData from content.source.data (Claude API format)
- [ ] Component extracts imageData from content.data (alternative format)
- [ ] Component extracts mediaType from content.source.media_type or content.media_type
- [ ] Component defaults to 'image/png' if mediaType missing
- [ ] Component shows error state if imageData missing
- [ ] Component uses lucide-react icons: ImageIcon, Download, Maximize2, X
- [ ] Unit tests cover both content formats and missing data

### Data URI Construction
- [ ] Detects if imageData already has 'data:' prefix
- [ ] Passes through data URIs unchanged if already formatted
- [ ] Constructs data URI for raw base64: `data:{mediaType};base64,{imageData}`
- [ ] Uses extracted mediaType or defaults to 'image/png'
- [ ] Data URI works in <img> src attribute
- [ ] Unit tests verify URI construction for all cases

### Download Functionality
- [ ] Download button appears in image header (Download icon)
- [ ] Button creates temporary <a> element with download attribute
- [ ] Button sets href to data URI
- [ ] Button generates filename: `image-{timestamp}.{extension}`
- [ ] Extension extracted from mediaType (e.g., 'image/png' â†’ 'png')
- [ ] Button removes <a> element after triggering download
- [ ] Button has hover state with gray accent
- [ ] Unit tests verify download behavior (mock DOM methods)

### Inline Image Display
- [ ] Image renders in <img> tag with data URI as src
- [ ] Image has max-width: 100% for responsive sizing
- [ ] Image has auto height to maintain aspect ratio
- [ ] Image has rounded corners (rounded class)
- [ ] Image has pointer cursor to indicate clickability
- [ ] Image is wrapped in white background card with padding
- [ ] Image header shows media type and icon
- [ ] Image click triggers fullscreen view
- [ ] Image has onError handler to show error state

### Fullscreen Zoom Modal
- [ ] Maximize button in header triggers fullscreen modal
- [ ] Click on inline image triggers fullscreen modal
- [ ] Modal uses fixed positioning with z-50
- [ ] Modal has dark overlay (bg-black bg-opacity-90)
- [ ] Modal displays image centered with max-w-90vw max-h-90vh
- [ ] Close button appears above image (X icon)
- [ ] Click on overlay closes modal
- [ ] Click on image does not close modal (stopPropagation)
- [ ] Close button click closes modal
- [ ] Unit tests verify modal open/close behavior

### Error Handling
- [ ] Shows warning state if imageData is undefined/null
- [ ] Warning state displays amber background with ImageIcon
- [ ] Warning state shows "No image data available" message
- [ ] Shows error state if image fails to load (onError event)
- [ ] Error state displays red background with ImageIcon
- [ ] Error state shows "Failed to load image" message
- [ ] Error state includes collapsible raw data details
- [ ] Unit tests verify all error states

### MessageContent Integration
- [ ] MessageContent imports ImageContent component
- [ ] MessageContent renders ImageContent for content.type === 'image'
- [ ] Passes entire content object to ImageContent component
- [ ] Handles missing or malformed image content gracefully
- [ ] Integration tests verify image rendering in full request view
- [ ] Images appear correctly in Requests page detail panel
- [ ] Multiple images in single message render sequentially

---

## Sprint Scope

### This Sprint Delivers
1. **ImageContent Component** - Full-featured inline image display
2. **Download Functionality** - Save images to local filesystem
3. **Fullscreen Zoom** - Lightbox modal for large image viewing
4. **MessageContent Integration** - Images visible in Requests page

### Deferred
- Image thumbnails in request list
- Image comparison between requests
- Image lazy loading optimization
- Advanced zoom controls (pan, zoom levels)
