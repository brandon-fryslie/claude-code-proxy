# Definition of Done: Request Comparison

**Generated**: 2025-12-24-165000
**Plan**: PLAN-2025-12-24-165000.md

---

## Acceptance Criteria

### Multi-Select Request UI
- [ ] User can select/deselect individual requests via checkbox or click modifier
- [ ] Visual indicator (highlight/checkbox) shows which requests are selected
- [ ] "Compare Selected" button appears when 2 requests are selected
- [ ] Button is disabled when 0, 1, or 3+ requests are selected
- [ ] "Clear Selection" action resets all selections
- [ ] Selection state persists when scrolling through virtualized list
- [ ] Unit test: Selection state management handles edge cases (select same request twice, deselect correctly)

### Side-by-Side Comparison Layout
- [ ] Side-by-side layout displays 2 requests with clear visual separation (50/50 split or adjustable)
- [ ] Metadata section shows model, timestamp, endpoint for both requests
- [ ] Collapsible sections for Request Body, System Messages, Tools, Response, Usage
- [ ] All sections can expand/collapse independently
- [ ] Visual hierarchy matches existing RequestDetailContent pattern
- [ ] Close button returns user to request list
- [ ] Layout is responsive and usable on smaller screens (stacks vertically if needed)
- [ ] Unit test: Component renders with 2 request objects and displays key fields correctly

### Request/Response Content Diffing
- [ ] Request body differences highlighted (system messages, user prompts, tool definitions)
- [ ] Response content differences highlighted (assistant messages, tool use/results)
- [ ] Line-by-line diff with color coding: green (+), red (-), gray (unchanged)
- [ ] JSON objects are formatted and compared structurally (not string comparison)
- [ ] Long content can be collapsed/expanded to show only changed sections
- [ ] Empty/null values handled gracefully (e.g., one request has tools, other doesn't)
- [ ] Unit test: Diff algorithm correctly identifies additions, deletions, and unchanged lines
- [ ] E2E test: Compare 2 known requests and verify diff highlights appear correctly

### Token and Performance Metrics Comparison
- [ ] Token comparison table shows: input_tokens, output_tokens, cache_creation_input_tokens, cache_read_input_tokens, total_tokens
- [ ] Deltas calculated and displayed (absolute difference and percentage)
- [ ] Color coding: green for better (lower cost/time), red for worse
- [ ] Response time comparison with delta
- [ ] Handle missing usage data gracefully (show "N/A" or "-")
- [ ] Visual indicator if one request used caching and other didn't
- [ ] Unit test: Delta calculations are accurate for various token combinations

### Model and Routing Comparison
- [ ] Display originalModel and routedModel for both requests
- [ ] Highlight if routing differed (one routed to subagent, other didn't)
- [ ] Show provider information (Anthropic vs OpenAI)
- [ ] Visual indicator if models are identical vs different
- [ ] Handle requests without routing data (non-subagent requests)
- [ ] Unit test: Correctly identifies routing differences in test cases

### Export Comparison Data
- [ ] Export button triggers download of comparison JSON file
- [ ] JSON structure includes: both request IDs, metadata, usage comparison, timing comparison, content diffs
- [ ] Filename includes both request IDs and timestamp (e.g., `comparison_1234_5678_20251224.json`)
- [ ] JSON is properly formatted and parseable
- [ ] Export includes human-readable summary section
- [ ] Unit test: Exported JSON has all required fields and valid structure

---

## Sprint Scope

**This sprint delivers**:
1. Multi-select UI for request list
2. Side-by-side comparison modal with all sections
3. Full diff visualization for content, tokens, and metrics

**Deferred**:
- Comparison history/saving
- Semantic diff analysis
- Compare 3+ requests
- AI-powered comparison summaries
