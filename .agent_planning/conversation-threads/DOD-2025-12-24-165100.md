# Definition of Done: Conversation Threads

**Generated**: 2025-12-24-165100
**Plan**: PLAN-2025-12-24-165100.md

---

## Acceptance Criteria

### Conversation Data Model Alignment
- [ ] Backend `/api/conversations` endpoint response structure documented
- [ ] Frontend TypeScript types match backend JSON structure exactly
- [ ] Adapter function created if transformation needed (old → new format)
- [ ] Sample conversation data from backend validated against types
- [ ] Session metadata includes: sessionId, projectPath, projectName, startTime, endTime, messageCount
- [ ] Message structure includes: uuid, timestamp, role, content, tool calls, parent relationships
- [ ] Unit test: Adapter correctly transforms sample conversation data

### Message Thread Display Component
- [ ] Messages displayed in chronological order (top to bottom or bottom to top)
- [ ] User messages styled differently from assistant messages (color/alignment)
- [ ] Each message shows timestamp and turn number
- [ ] Message content rendered with proper formatting (whitespace, code blocks)
- [ ] Tool calls displayed inline with assistant messages (not separate)
- [ ] Tool results displayed inline with assistant messages
- [ ] Long messages can be collapsed/expanded
- [ ] Conversation scrolls smoothly with 100+ messages
- [ ] Unit test: Component renders conversation with 10 messages correctly
- [ ] E2E test: Load conversation from API and verify all messages appear

### Tool Call Visualization Inline
- [ ] Tool call displays: tool name, input parameters (formatted JSON)
- [ ] Tool result displays: return value or error, execution status
- [ ] Tool calls visually distinct from message text (border, background, icon)
- [ ] Input parameters syntax-highlighted if code or JSON
- [ ] Result output syntax-highlighted if code or JSON
- [ ] Long inputs/results collapsed by default with expand button
- [ ] Multiple tool calls in same message displayed sequentially
- [ ] Error tool results highlighted (red border or warning icon)
- [ ] Unit test: Tool call component renders all fields correctly
- [ ] Unit test: Tool result component handles success and error cases

### Conversation List View
- [ ] List shows all conversations sorted by most recent first
- [ ] Each item displays: project name, session ID (truncated), message count, start/end time
- [ ] Click on conversation loads full message thread
- [ ] Visual indicator for active (ongoing) vs completed conversations
- [ ] Conversation duration displayed (e.g., "2h 15m")
- [ ] List loads quickly even with 50+ conversations (use summary endpoint)
- [ ] Empty state message when no conversations exist
- [ ] Unit test: List renders with sample conversation data
- [ ] E2E test: Click conversation item → full thread loads

### Message Flow Diagram
- [ ] Flow diagram shows messages as nodes connected by edges
- [ ] User messages, assistant messages, tool calls visually distinct (shape/color)
- [ ] Parent-child relationships visible (lines connecting related messages)
- [ ] Branching shown for sidechain conversations (subagents)
- [ ] Click on node highlights corresponding message in thread
- [ ] Diagram auto-layouts for readability (no overlapping nodes)
- [ ] Zoom and pan controls for large conversations
- [ ] Toggle to show/hide flow diagram (default collapsed)
- [ ] Unit test: Flow graph correctly represents conversation structure
- [ ] E2E test: Load conversation with branching → diagram shows branches

### Conversation Metadata Panel
- [ ] Session ID displayed (full or truncated with copy button)
- [ ] Project name and path shown
- [ ] Start and end timestamps with duration calculation
- [ ] Total message count (user + assistant)
- [ ] Tool usage summary (e.g., "15 tool calls across 8 messages")
- [ ] Model information if available (primary model used)
- [ ] Metadata panel collapsible to save screen space
- [ ] Unit test: Metadata calculations (duration, message count) are accurate

### Expand/Collapse All Messages
- [ ] "Expand All" button shows full content for all messages
- [ ] "Collapse All" button shows only message headers (role + timestamp)
- [ ] Individual expand/collapse still works after global action
- [ ] State persists when switching between conversations (or resets, document behavior)
- [ ] Button states clear (don't show "Expand All" if all already expanded)
- [ ] Unit test: Expand/collapse state management correct for various scenarios

---

## Sprint Scope

**This sprint delivers**:
1. Full conversation thread viewing with message bubbles
2. Tool call and result visualization inline
3. Conversation list with metadata

**Deferred**:
- Real-time conversation updates
- Conversation search/filtering
- Exporting conversations
- Advanced analytics on conversation patterns
