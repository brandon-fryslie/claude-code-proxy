# Definition of Done: Unified Conversation Search

**Sprint Date:** 2026-01-12

---

## P0: Backend - Enhanced Search API

### Acceptance Criteria

1. **API Response Format**
   - [ ] `GET /api/v2/conversations/search?q=test` returns results with `messages[]` array per conversation
   - [ ] Each message result includes: `uuid`, `type`, `isSubagent`, `snippet` (~100 chars), `timestamp`
   - [ ] Results grouped by conversation with `conversationId`, `projectName`, `lastActivity`

2. **Type Filtering**
   - [ ] `GET /api/v2/conversations/search?q=test&types=user` returns only user messages
   - [ ] `GET /api/v2/conversations/search?q=test&types=claude` returns main Claude messages (agent_id IS NULL)
   - [ ] `GET /api/v2/conversations/search?q=test&types=subagent` returns only messages with non-null agent_id
   - [ ] `GET /api/v2/conversations/search?q=test&types=other` returns non-user/non-assistant messages
   - [ ] Multiple types work: `types=user,claude` returns both
   - [ ] Missing `types` parameter defaults to all types (no filter)

3. **Performance**
   - [ ] Search completes in <500ms for typical queries

---

## P1: Frontend - Global Search Component

### Acceptance Criteria

1. **Search Input Behavior**
   - [ ] Empty search input shows recent conversations list (unchanged)
   - [ ] Typing triggers API search after 300ms debounce
   - [ ] Clear button (X) clears search and shows recent conversations

2. **Filter Checkboxes**
   - [ ] Four checkboxes visible: User, Claude, Subagents, Other
   - [ ] All checkboxes ON by default
   - [ ] Unchecking a filter removes those message types from results
   - [ ] Filter changes trigger new search

3. **Results Display**
   - [ ] Results grouped under conversation headers (project name + time ago)
   - [ ] Each message shows snippet with search term visible
   - [ ] Message type indicator visible (User/Claude/Subagent badge)
   - [ ] Clicking result selects that conversation in detail pane

4. **Empty States**
   - [ ] "No results found" message when search returns empty
   - [ ] Loading indicator while search is in progress
