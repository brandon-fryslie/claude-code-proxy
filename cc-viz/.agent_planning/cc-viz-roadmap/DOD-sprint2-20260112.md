# Definition of Done: CC-VIZ Sprint 2 (Revised)
Generated: 2026-01-12

**Scope**: Session Data Visualizer only (todos, plans) with database backend

---

## Database & Indexing Acceptance Criteria

- [ ] **AC-DB.1**: SQLite tables created on proxy-data startup:
  - `claude_todos` - Individual todo items
  - `claude_todo_sessions` - Aggregated session stats
  - `claude_plans` - Plan documents

- [ ] **AC-DB.2**: Indexes created for:
  - `claude_todos(session_uuid)`
  - `claude_todos(status)`
  - `claude_todos(modified_at)`
  - `claude_plans(modified_at)`

- [ ] **AC-IDX.1**: Indexer scans `~/.claude/todos/`:
  - Parses filename to extract session_uuid, agent_uuid
  - Validates JSON structure
  - Inserts/updates entries in database

- [ ] **AC-IDX.2**: Indexer scans `~/.claude/plans/`:
  - Reads markdown content
  - Generates preview (first 200 chars)
  - Inserts/updates entries in database

- [ ] **AC-IDX.3**: Invalid files handled gracefully:
  - Empty files skipped
  - Invalid JSON logged and skipped
  - Missing fields use defaults

- [ ] **AC-IDX.4**: Incremental indexing:
  - Only processes files modified since last index
  - Full reindex available on demand

---

## Backend API Acceptance Criteria

- [ ] **AC-API.1**: `GET /api/v2/claude/todos` returns JSON with:
  - `total_files`: integer (from session count)
  - `non_empty_files`: integer (sessions with todo_count > 0)
  - `status_breakdown`: {pending, in_progress, completed}
  - `sessions`: array of TodoSession objects
  - `last_indexed`: timestamp
  - Data comes FROM DATABASE, not filesystem

- [ ] **AC-API.2**: `GET /api/v2/claude/todos/{session_uuid}` returns JSON with:
  - `session_uuid`, `agent_uuid` fields
  - `todos`: array of {content, status, active_form}
  - Returns 404 for non-existent sessions
  - Data comes FROM DATABASE

- [ ] **AC-API.3**: `GET /api/v2/claude/plans` returns JSON with:
  - `total_count`: integer
  - `total_size`: sum of file sizes
  - `plans`: array with id, file_name, name, preview, modified_at
  - `last_indexed`: timestamp
  - Data comes FROM DATABASE

- [ ] **AC-API.4**: `GET /api/v2/claude/plans/{id}` returns JSON with:
  - `content`: full markdown content
  - Returns 404 for non-existent IDs
  - Data comes FROM DATABASE

- [ ] **AC-API.5**: `POST /api/v2/claude/todos/reindex` returns:
  - `files_processed`: count
  - `todos_indexed`: count
  - `errors`: array of error messages (if any)
  - `duration`: string

---

## Frontend UI Acceptance Criteria

- [ ] **AC-UI.1**: Session Data page accessible at `/cc-viz/session-data`

- [ ] **AC-UI.2**: Todos tab displays:
  - Summary cards: Total files, Non-empty, Status breakdown
  - "Last indexed" timestamp with refresh button
  - Session list with search capability
  - Sessions show: session_uuid (truncated), todo count, status counts, relative time

- [ ] **AC-UI.3**: Clicking a todo session shows detail pane with:
  - Full session_uuid and agent_uuid
  - All todo items with colored status badges:
    - Pending: gray
    - In Progress: blue
    - Completed: green

- [ ] **AC-UI.4**: Plans tab displays:
  - List of all plans with display name, file size, relative time
  - Preview text visible in list

- [ ] **AC-UI.5**: Clicking a plan shows full markdown content in detail pane

- [ ] **AC-UI.6**: Refresh button triggers reindex and shows loading state

---

## Navigation Acceptance Criteria

- [ ] **AC-NAV.1**: Sidebar "Session Data" item is enabled with href `/cc-viz/session-data`

- [ ] **AC-NAV.2**: Home page "Session Data" card is clickable with href `/cc-viz/session-data`

---

## Cross-Cutting Acceptance Criteria

- [ ] **AC-X.1**: No TypeScript compilation errors (`npm run typecheck`)

- [ ] **AC-X.2**: No console errors when navigating to Session Data page

- [ ] **AC-X.3**: Loading states displayed while fetching data

- [ ] **AC-X.4**: Error states displayed when API calls fail

- [ ] **AC-X.5**: All API endpoints use snake_case JSON field names

- [ ] **AC-X.6**: Backend builds without errors (`just build`)

- [ ] **AC-X.7**: No filesystem reads in API handlers - all data from database

---

## Verification Method

1. **Database**: Query SQLite directly to verify tables exist and contain data
2. **API**: curl endpoints and verify JSON structure
3. **UI**: Chrome DevTools MCP to navigate, take snapshots, check console
4. **Indexer**: Check logs for processed files and any errors
