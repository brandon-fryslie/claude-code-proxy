# Claude Code Proxy - Caddy Reverse Proxy Configuration for Docker (Development)
#
# Routes requests to appropriate backend services:
# - /v1/* routes to proxy-core - lightweight proxy
# - /api/* routes to proxy-data - dashboard APIs
# - /health routes to proxy-core for health checks

{
	admin off
}

:3000 {
	encode gzip

	log {
		output stdout
		format console
	}

	# Health check - route to proxy-core
	handle /health {
		reverse_proxy proxy-core:3001
	}

	# Proxy API routes - route to proxy-core
	handle /v1/* {
		reverse_proxy proxy-core:3001 {
			flush_interval -1
		}
	}

	# Dashboard API routes - route to proxy-data
	handle /api/* {
		reverse_proxy proxy-data:3002
	}

	# UI routes - route to proxy-data
	handle /ui {
		reverse_proxy proxy-data:3002
	}

	# Root path - route to proxy-data for UI
	handle / {
		reverse_proxy proxy-data:3002
	}

	handle {
		respond "Not Found" 404
	}
}
